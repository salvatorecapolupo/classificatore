<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Simulatore KNN</title>
  <style>
    body { font-family: sans-serif; text-align: center; }
    canvas { border: 1px solid black; margin-top: 10px; cursor: crosshair; }
  </style>
</head>
<body>
  <h1>Simulatore KNN con visualizzazione dello spazio decisionale</h1>
  <label><input type="radio" name="class" value="0" checked> Classe 0 (Blu)</label>
  <label><input type="radio" name="class" value="1"> Classe 1 (Rosso)</label>
  <label>k: <input type="number" id="kValue" value="3" min="1" max="20" style="width: 50px;"></label>
  <button onclick="drawDecisionBoundary()">Classifica spazio</button>
  <button onclick="reset()">Reset</button>
  <br>
  <canvas id="canvas" width="300" height="300"></canvas>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const kInput = document.getElementById('kValue');
    let trainingData = [];

    canvas.addEventListener('click', function (e) {
      const rect = canvas.getBoundingClientRect();
      const x = Math.floor(e.clientX - rect.left);
      const y = Math.floor(e.clientY - rect.top);
      const label = parseInt(document.querySelector('input[name="class"]:checked').value);
      trainingData.push({ x, y, label });
      drawPoint(x, y, label);
    });

    function drawPoint(x, y, label) {
      ctx.beginPath();
      ctx.arc(x, y, 4, 0, Math.PI * 2);
      ctx.fillStyle = label === 0 ? 'blue' : 'red';
      ctx.fill();
    }

    function knn(x, y, k) {
      const distances = trainingData.map(p => ({
        label: p.label,
        dist: Math.hypot(p.x - x, p.y - y)
      }));
      distances.sort((a, b) => a.dist - b.dist);
      const kNearest = distances.slice(0, k);
      const counts = [0, 0];
      kNearest.forEach(p => counts[p.label]++);
      return counts[0] > counts[1] ? 0 : 1;
    }

    function drawDecisionBoundary() {
      if (trainingData.length === 0) {
        alert("Aggiungi prima dei punti di addestramento.");
        return;
      }

      const k = parseInt(kInput.value);
      const img = ctx.createImageData(canvas.width, canvas.height);
      for (let y = 0; y < canvas.height; y++) {
        for (let x = 0; x < canvas.width; x++) {
          const label = knn(x, y, k);
          const index = (y * canvas.width + x) * 4;
          if (label === 0) {
            img.data[index + 0] = 150; // blue-ish
            img.data[index + 1] = 180;
            img.data[index + 2] = 255;
          } else {
            img.data[index + 0] = 255;
            img.data[index + 1] = 180;
            img.data[index + 2] = 180;
          }
          img.data[index + 3] = 255;
        }
      }
      ctx.putImageData(img, 0, 0);

      // Redisegna i punti sopra la mappa
      for (const p of trainingData) {
        drawPoint(p.x, p.y, p.label);
      }
    }

    function reset() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      trainingData = [];
    }
  </script>
</body>
</html>
